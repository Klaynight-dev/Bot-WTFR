<%- include('partials/head') %>
    <%- include('partials/header', { user }) %>
        <main>

            <%# ═══ PAGE: SETTINGS (Per-Guild Config) ═══ %>

                <div class="animate-in">
                    <div class="settings-header">
                        <div class="settings-guild-icon">
                            <% if (guild.icon) { %>
                                <img src="<%= guild.icon %>" alt=""
                                    style="width:100%;height:100%;border-radius:10px;object-fit:cover;">
                                <% } else { %>
                                    <img src="/assets/img/castle.svg" alt="" class="icon icon-white">
                                    <% } %>
                        </div>
                        <div>
                            <h1 style="margin-bottom: 0; font-size: 1.8rem;">
                                <%= guild.name %>
                            </h1>
                            <span class="badge badge-blurple" style="margin-top: 0.25rem;">ID: <%= guild.id %></span>
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- SETTINGS FORM -->
                <form id="settingsForm" action="/dashboard/<%= guild.id %>" method="POST"
                    data-guild-id="<%= guild.id %>">
                    <div class="grid grid-2">
                        <%- include('partials/setting-field', { icon: 'radar' , label: 'Canal de Logs' ,
                            name: 'logChannelId' , value: config.logChannelId || '' ,
                            hint: 'Salon où envoyer les logs (messages supprimés, modifications, etc.)' , type: 'select'
                            , options: textChannels }) %>

                            <%- include('partials/setting-field', { icon: 'welcome' , label: 'Canal Bienvenue/Départ' ,
                                name: 'welcomeChannelId' , value: config.welcomeChannelId || '' ,
                                hint: 'Salon pour les images de bienvenue et messages de départ' , type: 'select' ,
                                options: textChannels }) %>

                                <%- include('partials/setting-field', { icon: 'medal' , label: 'Auto-Rôle' ,
                                    name: 'autoRole' , value: config.autoRole || '' ,
                                    hint: 'Rôle attribué automatiquement aux nouvelles recrues' , type: 'select' ,
                                    options: roles }) %>

                                    <%- include('partials/setting-field', { icon: 'ticket' , label: 'Catégorie Tickets'
                                        , name: 'ticketCategoryId' , value: config.ticketCategoryId || '' ,
                                        hint: 'Catégorie où créer les tickets de support' , type: 'select' , options:
                                        categories }) %>

                                        <%- include('partials/setting-field', { icon: 'shield' , label: 'Anti-Spam' ,
                                            name: 'antiSpam' , value: config.antiSpam || false,
                                            hint: 'Détection et suppression automatique du spam' , type: 'toggle' ,
                                            options: [] }) %>

                                            <%- include('partials/setting-field', { icon: 'shield' , label: 'Anti-Lien'
                                                , name: 'antiLink' , value: config.antiLink || false,
                                                hint: 'Suppression automatique des liens non autorisés' , type: 'toggle'
                                                , options: [] }) %>
                    </div>

                    <!-- ACTIONS -->
                    <div class="settings-actions animate-in">
                        <button type="submit" class="btn btn-neon btn-lg" id="saveBtn">
                            <img src="/assets/img/save.svg" alt="" class="icon">
                            Sauvegarder
                        </button>
                        <a href="/dashboard" class="btn btn-ghost">
                            <img src="/assets/img/arrow-left.svg" alt="" class="icon icon-sm icon-muted">
                            Retour
                        </a>
                    </div>
                </form>

        </main>
        <%- include('partials/footer') %>