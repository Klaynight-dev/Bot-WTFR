generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model Pseudo {
  id        String   @id
  display   String
  roblox    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Warning {
  id          Int      @id @default(autoincrement())
  userId      String
  moderatorId String
  reason      String
  date        DateTime @default(now())
}

model MessageState {
  id        Int     @id @default(autoincrement())
  channelId String?
  messageId String?
  page      Int?
}

model GuildConfig {
  id                  String   @id // Guild ID
  // ─── Channels ───
  logChannelId        String?
  modLogChannelId     String?  // Logs modération séparés
  panelLogChannelId   String?  // Logs actions panel
  welcomeChannelId    String?
  goodbyeChannelId    String?
  ticketCategoryId    String?

  // ─── Roles ───
  autoRole            String?
  staffRoles          String[] // Rôles staff (modérateurs)
  panelRoles          String[] // Rôles ayant accès au dashboard
  panelUsers          String[] // Users spécifiques autorisés panel

  // ─── Auto-Moderation ───
  antiSpam            Boolean  @default(false)
  antiLink            Boolean  @default(false)
  antiInvite          Boolean  @default(false)
  antiMajuscules      Boolean  @default(false)

  // ─── Welcome/Goodbye ───
  welcomeMessage      String?  // Message custom: {user} {server} {count}
  goodbyeMessage      String?
  welcomeImageEnabled Boolean  @default(true)

  updatedAt           DateTime @updatedAt
}

model CommandConfig {
  id              Int      @id @default(autoincrement())
  guildId         String
  commandName     String
  enabled         Boolean  @default(true)
  allowedRoles    String[] // Vide = tout le monde (selon perms Discord)
  allowedChannels String[] // Vide = partout
  @@unique([guildId, commandName])
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  userName  String
  action    String   // "config.update", "command.toggle", "panel.login"
  details   String?  // JSON détails
  source    String   @default("panel") // "panel" | "bot" | "discord"
  createdAt DateTime @default(now())
}

model Ticket {
  id        Int      @id @default(autoincrement())
  channelId String   @unique
  userId    String
  closed    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// ─── LEVELING SYSTEM ───

model Level {
  id              Int      @id @default(autoincrement())
  userId          String
  guildId         String
  xp              Int      @default(0)
  level           Int      @default(0)
  lastMessageDate DateTime @default(now())
  lastVoiceDate   DateTime?

  @@unique([userId, guildId])
}

model LevelConfig {
  guildId             String   @id
  enabled             Boolean  @default(true)
  messageXpMin        Int      @default(15)
  messageXpMax        Int      @default(25)
  voiceXp             Int      @default(10)
  voiceInterval       Int      @default(60)
  cooldown            Int      @default(60)
  announceChannelId   String?
  announceMessage     String?
  levelUpNotification Boolean  @default(true)
}

model LevelReward {
  id      Int    @id @default(autoincrement())
  guildId String
  level   Int
  roleId  String
  stack   Boolean @default(true)

  @@unique([guildId, level])
}

model LevelMultiplier {
  id         Int     @id @default(autoincrement())
  guildId    String
  targetId   String
  type       String  // "ROLE", "CHANNEL", "USER"
  multiplier Float
}
